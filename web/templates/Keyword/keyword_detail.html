{% extends "base.html" %}

{% block title %}{{ _('Keyword Details') }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="bi bi-key me-2"></i>
        {{ _('Keyword Details') }}
    </h1>
    <a href="{{ url_for('keywords_list') }}" class="btn btn-outline-primary">
        <i class="bi bi-arrow-left me-2"></i>
        {{ _('Back to Keywords') }}
    </a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="stat-card">
            <h5 class="mb-3">{{ _('Keyword Information') }}</h5>
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">{{ _('Keyword ID') }}</label>
                        <p class="form-control-plaintext">{{ keyword.id }}</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">{{ _('Usage Count') }}</label>
                        <p class="form-control-plaintext">
                            <span class="badge bg-info">{{ keyword.usage_count }}</span> files
                        </p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">{{ _('File Types') }}</label>
                        <p class="form-control-plaintext">
                            <span class="badge bg-secondary">{{ keyword.file_types|default(0) }}</span> types
                        </p>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">{{ _('Keyword Text') }}</label>
                <p class="form-control-plaintext"><strong>{{ keyword.text }}</strong></p>
            </div>
            {% if keyword.last_used %}
            <div class="mb-3">
                <label class="form-label">{{ _('Last Used') }}</label>
                <p class="form-control-plaintext text-muted">{{ keyword.last_used.strftime('%Y-%m-%d %H:%M') }}</p>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card">
            <h5 class="mb-3">{{ _('Actions') }}</h5>
            <div class="d-grid gap-2">
                <a href="{{ url_for('keywords_add') }}?keyword_id={{ keyword.id }}" class="btn btn-success">
                    <i class="bi bi-pencil me-2"></i> {{ _('Edit Keyword') }}
                </a>
    <!--            <button class="btn btn-outline-danger" onclick="deleteKeyword({{ keyword.id }})">
                    <i class="bi bi-trash me-2"></i> {{ _('Delete Keyword') }}
                </button> -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Translations for JavaScript
const translations = {
    deleteConfirm: {{ _('Are you sure you want to delete this keyword?')|tojson }},
    keywordDeletedSuccessfully: {{ _('Keyword deleted successfully!')|tojson }},
    error: {{ _('Error')|tojson }}
};

// âœ… SECURITY: Helper function to get CSRF token
function getCSRFToken() {
    const metaTag = document.querySelector('meta[name="csrf-token"]');
    return metaTag ? metaTag.getAttribute('content') : '';
}

function deleteKeyword(id) {
    if (confirm(translations.deleteConfirm)) {
        fetch(`/api/keywords/${id}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            }
        })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    alert(translations.keywordDeletedSuccessfully);
                    window.location.href = "{{ url_for('keywords_list') }}";
                } else {
                    alert(translations.error + ': ' + data.error);
                }
            })
            .catch(e => alert(translations.error + ': ' + e.message));
    }
}
</script>
{% endblock %}
