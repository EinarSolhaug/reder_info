


<!-- templates/search.html -->
{% extends "base.html" %}

{% block title %}{{ _('Search') }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="bi bi-search me-2"></i>
        {{ _('Search Files') }}
    </h1>
</div>

<!-- Search View Navigation -->
<div class="search-view-navigation" style="margin-bottom: 2rem; border-bottom: 2px solid var(--border-color); padding-bottom: 1rem; background: var(--bg-section); padding: 1rem; border-radius: 8px;">
    <div class="d-flex gap-2 flex-wrap">
        <a href="{{ url_for('search_page') }}" class="btn btn-outline-primary search-view-btn {% if request.endpoint == 'search_page' %}active{% endif %}" data-view="search">
            <i class="bi bi-search"></i> {{ _('Search') }}
        </a>
        <a href="{{ url_for('search_advanced') }}" class="btn btn-outline-primary search-view-btn {% if request.endpoint == 'search_advanced' %}active{% endif %}" data-view="advanced">
            <i class="bi bi-funnel"></i> {{ _('Advanced Search') }}
        </a>
        <a href="{{ url_for('search_enhanced_page') }}" class="btn btn-outline-primary search-view-btn {% if request.endpoint == 'search_enhanced_page' %}active{% endif %}" data-view="enhanced">
            <i class="bi bi-search-heart"></i> {{ _('Enhanced Search') }}
        </a>
    </div>
</div>

<div class="stat-card mb-4">
    <form method="GET" action="{{ url_for('search_page') }}">
        <div class="row g-3">
            <div class="col-md-8">
                <input type="text" name="q" class="form-control form-control-lg" 
                       placeholder="{{ _('Search files...') }}" value="{{ query }}">
            </div>
            <div class="col-md-4">
                <button type="submit" class="btn btn-primary btn-lg w-100">
                    <i class="bi bi-search me-2"></i>
                    {{ _('Search') }}
                </button>
            </div>
        </div>
    </form>
</div>

{% if query %}
<div class="stat-card">
    <h5 class="mb-3">{{ _('Search Results') }} ({{ total_results|default(results|length) }} {{ _('found') }})</h5>
    
    {% if results %}
    <div class="list-group list-group-flush">
        {% for result in results %}
        <a href="{{ url_for('files.file_detail', file_id=result[0]) }}" 
           class="list-group-item list-group-item-action">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h6 class="mb-1">
                        <i class="bi bi-file-earmark me-2"></i>
                        {{ result[1] }}
                    </h6>
                    <small class="text-muted">
                        {{ _('Source:') }} {{ result[4] }} | {{ _('Side:') }} {{ result[5] }} | 
                        {{ _('Date:') }} {{ result[3].strftime('%Y-%m-%d') if result[3] else _('N/A') }}
                    </small>
                </div>
                <span class="badge bg-secondary">{{ result[2] }}</span>
            </div>
        </a>
        {% endfor %}
    </div>
    
    {% if total_pages and total_pages > 1 %}
    <nav aria-label="{{ _('Search pagination') }}" class="mt-4">
        <ul class="pagination justify-content-center">
            {% if page > 1 %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('search_page', q=query, page=page-1) }}">{{ _('Previous') }}</a>
            </li>
            {% endif %}
            
            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}
                    <li class="page-item active"><span class="page-link">{{ p }}</span></li>
                {% elif p <= 3 or p > total_pages - 3 or (p >= page - 1 and p <= page + 1) %}
                    <li class="page-item"><a class="page-link" href="{{ url_for('search_page', q=query, page=p) }}">{{ p }}</a></li>
                {% elif p == 4 or p == total_pages - 3 %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}
            {% endfor %}
            
            {% if page < total_pages %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('search_page', q=query, page=page+1) }}">{{ _('Next') }}</a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
    {% else %}
    <div class="text-center text-muted py-5">
        <i class="bi bi-search display-4 d-block mb-3"></i>
        <p>{{ _('No results found for') }} "{{ query }}"</p>
    </div>
    {% endif %}
</div>
{% endif %}

{% endblock %}